<!-- Belongs at: /_includes/navigation.html -->

<!-- This finds the current page so it can be highlighted. -->

{% for entry in site.data.navigation %}
{% capture fullurl %}{{ site.baseurl }}{{ entry.url }}{% endcapture %}
  {% if fullurl == page.url %}
    {% assign current_page = fullurl %}
    {% break %}
  {% elsif page.url contains fullurl %}
    {% assign current_page = fullurl %}
  {% endif %}
{% endfor %}

<!-- Then we build the nav bar. -->
<!-- current_page / page.url / entry.url -->
<nav>
  <ul>

  {% for entry in site.data.navigation %}

    <!-- {% if page.url == entry.url %}
      {% assign current = 'class="active"' %}
    {% else %}
      {% assign current = 'class=""' %}
    {% endif %} -->
    
    {% assign sublinks = entry.sublinks %}
    
    {% if sublinks %}

      <li {{ current }}>
        <span class="parent">
          {{ entry.title }}
        </span>

        <ul>
          {% for sublink in sublinks %}

          {% if page.url == sublink.url %}
            <li class="active"><a href="{{ site.baseurl }}{{ sublink.url }}">{{ sublink.title }}</a></li>
          {% else %}
            <li><a href="{{ site.baseurl }}{{ sublink.url }}">{{ sublink.title }}</a></li>
          {% endif %}

          {% endfor %}
        </ul>
      </li>

    {% else %}

      {% if page.url == entry.url %}
        {% assign current = 'class="active"' %}
      {% else %}
        {% assign current = '' %}
      {% endif %}
      
      <li {{ current }}>
        <span class="parent">
          <a href="{{ site.baseurl }}{{ entry.url }}">{{ entry.title }}</a>
        </span>
      </li>
      
    {% endif %}
    
  {% endfor %}
  </ul>
</nav>
